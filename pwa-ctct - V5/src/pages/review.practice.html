<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Xem l·∫°i &amp; Gi·∫£i th√≠ch ‚Äî √în tr·∫Øc nghi·ªám</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.webmanifest">

  <!-- CSS chung c·ªßa site -->
  <link rel="stylesheet" href="style.css?v=20250918">
  <link rel="stylesheet" href="nav.css?v=20250930">

  <!-- Giao di·ªán m·ªõi cho Review (gi·ªØ m√†u th∆∞∆°ng hi·ªáu) -->
  <style>
    :root{
      --brand:#A41919; --brand-600:#8B1616;
      --bg:#f6f7fb; --card:#fff; --text:#111827; --muted:#6b7280;
      --ok:#16a34a; --bad:#dc2626; --skip:#ca8a04; --border:#e5e7eb;
    }
    body{background:var(--bg); color:var(--text);}
    main{max-width:1100px; margin:0 auto; padding:16px 12px;}

    /* thanh c√¥ng c·ª• */
    .toolbar{
      display:flex; flex-wrap:wrap; gap:.6rem; align-items:center;
      background:var(--card); border:1px solid var(--border);
      border-radius:12px; padding:.75rem; box-shadow:0 2px 8px rgba(0,0,0,.05);
    }
    .toolbar input[type=checkbox]{transform:scale(1.2)}
    .toolbar .field{display:flex; align-items:center; gap:.5rem}
    .toolbar input[type=search]{
      flex:1; min-width:220px; border:1px solid var(--border);
      border-radius:10px; padding:10px 12px;
    }
    .toolbar .btn{
      border:1px solid var(--border); background:#fff; border-radius:10px;
      padding:10px 12px; font-weight:700; cursor:pointer;
    }

    /* th·ªëng k√™ */
    .stats{
      display:flex; flex-wrap:wrap; gap:.5rem; align-items:center;
      margin-top:10px; background:var(--card); border:1px solid var(--border);
      border-radius:12px; padding:8px 12px; box-shadow:0 2px 8px rgba(0,0,0,.05);
    }
    .chip{
      display:inline-flex; align-items:center; gap:6px;
      padding:6px 10px; border-radius:999px; border:1px solid var(--border);
      background:#fff; font-weight:700;
    }
    .chip.ok{color:var(--ok); background:#ecfdf5; border-color:#bbf7d0}
    .chip.bad{color:var(--bad); background:#fef2f2; border-color:#fecaca}
    .chip.skip{color:var(--skip); background:#fffbeb; border-color:#fde68a}
    .chips-right{margin-left:auto; color:var(--muted); font-weight:700}

    /* c√¢u h·ªèi */
    .qa{
      background:var(--card); border:1px solid var(--border);
      border-radius:12px; padding:14px; margin-top:12px;
      box-shadow:0 2px 6px rgba(0,0,0,.04);
    }
    .qa .result{font-weight:700; margin-bottom:8px}
    .qa.ok   .result{color:var(--ok)}
    .qa.ng   .result{color:var(--bad)}
    .qa.skip .result{color:var(--skip)}
    .exp{
      margin-top:8px; background:#f8fafc; border:1px dashed var(--border);
      border-radius:10px; padding:10px; color:#374151;
    }

    @media print{
      nav, .toolbar, .chips-right, .btn-print{display:none!important}
      main{padding:0; max-width:100%}
      .qa{page-break-inside:avoid}
    }
  </style>
</head>
<body>
  <nav class="nav nav-dark">
    <div class="nav__inner">
      <a href="index.html" class="brand">‚Üê Trang ch·ªß</a>
      <strong>XEM L·∫†I &amp; GI·∫¢I TH√çCH ‚Äî √îN TR·∫ÆC NGHI·ªÜM</strong>
    </div>
  </nav>

  <main>
    <!-- TOOLBAR: ch·ªâ c√≤n 3 m·ª•c theo ·∫£nh: checkbox, search, In/PDF -->
    <div class="toolbar">
      <label class="field"><input id="onlyWrong" type="checkbox"> Ch·ªâ hi·ªán c√¢u sai</label>
      <div class="field" style="flex:1">
        <input id="searchBox" type="search" placeholder="Nh·∫≠p t·ª´ kh√≥a‚Ä¶">
      </div>
      <button id="printBtn" class="btn btn-print">üñ®Ô∏è In/PDF</button>
    </div>

    <!-- TH·ªêNG K√ä ƒê·ªòNG -->
    <div class="stats" aria-live="polite">
      <span class="chip">üìã T·ªïng c√¢u: <b id="statTotal">0</b></span>
      <span class="chip ok">‚úî ƒê√∫ng: <b id="statOk">0</b></span>
      <span class="chip bad">‚úò Sai: <b id="statBad">0</b></span>
      <span class="chip skip">‚è≥ Ch∆∞a TL: <b id="statSkip">0</b></span>
      <span class="chips-right">Hi·ªÉn th·ªã: <b id="statVisible">0</b> m·ª•c</span>
    </div>

    <!-- DANH S√ÅCH C√ÇU (ƒë∆∞·ª£c render b·ªüi core) -->
    <div id="reviewList" style="margin-top:12px"></div>
  </main>

  <!-- Core normalize + render (ƒë√£ c√≥ s·∫µn trong d·ª± √°n c·ªßa anh) -->
  <script src="js/review-normalize.js?v=20251005"></script>
  <script src="js/review-core.js?v=20251005"></script>

  <!-- L·ªõp ‚Äúb·ªçc‚Äù giao di·ªán m·ªõi: √©p GI·∫¢I TH√çCH lu√¥n hi·ªán + ƒë·∫øm ƒë·ªông -->
  <script>
  (function () {
    const NS = window.CTCT_REVIEW;

    function forceShowExplanations(scope) {
      (scope || document).querySelectorAll('.exp, .muted').forEach(el => {
        el.hidden = false;
        el.style.display = ''; // xo√° m·ªçi ·∫©n hi·ªán tr∆∞·ªõc ƒë√≥
      });
    }

    function updateStats(scope){
      const root = scope || document;
      const items = Array.from(root.querySelectorAll('.qa, .qitem'));
      const total = items.length;
      let ok=0, bad=0, skip=0, visible=0;

      items.forEach(el=>{
        const isHidden = el.hidden || getComputedStyle(el).display === 'none';
        if (!isHidden) visible++;
        if (el.classList.contains('ok')  || el.dataset.ok === '1') ok++;
        else if (el.classList.contains('ng') || el.classList.contains('bad') || el.dataset.ok === '0') bad++;
        else if (el.classList.contains('skip')) skip++;
      });

      (document.getElementById('statTotal')   || {}).textContent = total;
      (document.getElementById('statOk')      || {}).textContent = ok;
      (document.getElementById('statBad')     || {}).textContent = bad;
      (document.getElementById('statSkip')    || {}).textContent = skip;
      (document.getElementById('statVisible') || {}).textContent = visible;
    }

    function boot(){
      if (!NS) return;

      // 1) Render danh s√°ch t·ª´ localStorage c·ªßa √îN TR·∫ÆC NGHI·ªÜM
      NS.renderReview('reviewList', 'ctct_try_last_result', {
        onRendered: () => {
          forceShowExplanations(document);
          updateStats(document);
        }
      });

      // 2) B·∫≠t b·ªô l·ªçc: ch·ªâ checkbox + search + in (kh√¥ng c√≤n dropdown gi·∫£i th√≠ch)
      const api = NS.bindControls({
        // ch·ªâ ƒë·ªãnh ph·∫°m vi ƒë·ªÉ core l·ªçc ƒë√∫ng
        scope: document
      });

      // 3) ‚ÄúB·ªçc‚Äù l·∫°i apply() c·ªßa core: sau m·ªói l·∫ßn l·ªçc ‚Üí √©p show exp + c·∫≠p nh·∫≠t ƒë·∫øm
      if (api && typeof api.apply === 'function') {
        const old = api.apply;
        api.apply = function(){
          old();
          forceShowExplanations(document);
          updateStats(document);
        };

        // g·∫Øn l·∫°i v√†o _auto ƒë·ªÉ c√°c n∆°i kh√°c g·ªçi v·∫´n ƒë√∫ng
        NS._auto = api;
      }

      // 4) In/PDF
      document.getElementById('printBtn')?.addEventListener('click', ()=>window.print());

      // 5) Kh·ªüi ƒë·ªông t√≠nh nƒÉng l·ªçc l·∫ßn ƒë·∫ßu (ƒë·ªìng th·ªùi c·∫≠p nh·∫≠t ƒë·∫øm)
      setTimeout(()=>{ NS._auto?.apply?.(); }, 0);
    }

    document.addEventListener('DOMContentLoaded', boot);
  })();
  </script>
</body>
</html>
