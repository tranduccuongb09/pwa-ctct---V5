<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ôn trắc nghiệm – CTĐ, CTCT</title>

  <link rel="manifest" href="../public/manifest.webmanifest">
  <!-- Global styles -->
  <link rel="stylesheet" href="../css/style.css">
  <link rel="stylesheet" href="nav.css?v=20250930">

  <style>
    :root{
      --brand:#A41919; --brand-600:#8B1616;
      --bg:#f5f6f8; --card:#fff; --text:#111827;
      --border:#e5e7eb; --muted:#6b7280;
    }
    *{box-sizing:border-box}
    html,body{
      margin:0; background:var(--bg); color:var(--text);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial
    }
    .topbar{
      display:flex; gap:12px; align-items:center;
      background:var(--brand); color:#fff; padding:14px 16px;
    }
    .topbar a{color:#fff;text-decoration:none}
    .topbar b{letter-spacing:.3px}
    .container{max-width:1100px;margin:16px auto;padding:0 12px}
    .card{
      background:var(--card); border:1px solid var(--border);
      border-radius:16px; box-shadow:0 2px 10px rgba(0,0,0,.06);
      padding:18px; margin:12px auto;
    }
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media (max-width:800px){.row{grid-template-columns:1fr}}
    .select{width:100%;padding:12px;border:1px solid var(--border);border-radius:12px}
    .btn{padding:12px 18px;border-radius:12px;border:none;font-weight:800;cursor:pointer}
    .btn-primary{background:var(--brand);color:#fff}
    .btn-primary:hover{background:var(--brand-600)}
    .btn-ghost{background:#fff;border:1px solid var(--border)}
    .muted{color:var(--muted)}
    .muted-small{color:var(--muted);font-size:13px}
    .bar{height:8px;background:#f3f4f6;border-radius:999px;overflow:hidden}
    .bar>span{display:block;height:100%;background:var(--brand);width:0%}
    .option{display:block;padding:10px;border:1px solid var(--border);border-radius:12px;margin:8px 0}
    .navs{display:flex;gap:10px;flex-wrap:wrap}
  </style>

  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => navigator.serviceWorker.register('../sw.js'));
    }
  </script>
</head>
<body class="page-practice" data-mode="practice">
  <div class="topbar">
    <a href="../index.html">← Trang chủ</a>
    <b>ÔN TRẮC NGHIỆM</b>
  </div>

  <main class="container">
    <!-- CÂU HAY TRẢ LỜI SAI -->
    <section id="wrongSection" class="card">
      <h3 style="margin:0 0 8px">Câu hay trả lời sai</h3>
      <div id="wrongList" class="muted">Đang tải…</div>
      <div class="muted-small">Gợi ý tập trung vào các câu có tỷ lệ sai cao.</div>
    </section>

    <!-- START -->
    <section id="startCard" class="card">
      <div class="row" style="margin:10px 0 14px">
        <label>Đối tượng
          <select id="practiceTopic" class="select">
            <option value="DQTV">DQTV</option>
            <option value="LLTT">LLTT</option>
          </select>
        </label>
        <div class="muted" style="align-self:center">Thời gian: <b>∞</b> • Số câu mặc định: 50</div>
      </div>
      <div style="text-align:right">
        <button id="resumeBtn" class="btn btn-ghost" hidden>Tiếp tục lần ôn trước</button>
        <button id="startBtn" class="btn btn-primary">Bắt đầu ôn</button>
      </div>
    </section>

    <!-- LÀM BÀI -->
    <section id="quizBox" class="card" hidden>
      <div class="qhead" style="display:flex;justify-content:space-between;align-items:center">
        <div><b id="qTitle">Câu 1</b></div>
        <div>Thời gian: <b id="time">∞</b></div>
      </div>
      <div class="bar"><span id="progressFill"></span></div>
      <div class="muted" style="margin-top:6px">Tiến độ: <span id="progress">0/50</span></div>

      <h3 id="qText" style="margin:10px 0 6px"></h3>
      <div id="options"></div>

      <div class="navs">
        <button id="prevBtn" class="btn btn-ghost">← Trước</button>
        <button id="nextBtn" class="btn btn-ghost">Tiếp →</button>
        <button id="reviewBtn" class="btn btn-ghost">Câu chưa trả lời</button>
        <button id="submitBtn" class="btn btn-primary" style="margin-left:auto">Kết thúc lần ôn</button>
      </div>
    </section>

    <!-- KẾT QUẢ -->
    <section id="resultCard" class="card" hidden>
      <h3 id="resultText" style="margin-top:0">Kết quả ôn tập</h3>
      <div class="muted" id="classification"></div>
      <div style="margin-top:12px; display:flex; gap:10px; flex-wrap:wrap">
        <a id="reviewLink" class="btn btn-ghost" href="review.practice.html" rel="external" data-hardlink="true">
          Xem lại & giải thích
        </a>
        <a class="btn btn-primary" href="index.html">Về Trang chủ</a>
      </div>
    </section>
  </main>

  <!-- cấu hình + helpers -->
  <script src="../js/config.js"></script>
  <script src="../js/net.js"></script>
  <script src="../js/analytics.js"></script>
  <script src="../js/navbar.js" defer></script>

  <!-- Engine -->
  <script src="../js/app.try.js" defer></script>

  <!-- Ẩn "Câu hay trả lời sai" khi bắt đầu -->
  <script>
  (function () {
    const wrong = document.getElementById('wrongSection');
    const startBtn = document.getElementById('startBtn');
    const resumeBtn = document.getElementById('resumeBtn');
    const quizBox = document.getElementById('quizBox');
    if (!wrong) return;

    function hideWrong(){ wrong.hidden = true; }

    startBtn && startBtn.addEventListener('click', hideWrong, { once:true });
    resumeBtn && resumeBtn.addEventListener('click', hideWrong, { once:true });

    if (quizBox) {
      const ob = new MutationObserver(()=>{
        if (!quizBox.hidden){ hideWrong(); ob.disconnect(); }
      });
      ob.observe(quizBox, { attributes:true, attributeFilter:['hidden'] });
    }
  })();
  </script>

  <!-- Ép điều hướng đúng sang review.practice.html -->
  <script>
  (function(){
    document.body.dataset.mode = 'practice';
    sessionStorage.setItem('ctct_mode', 'practice');
    sessionStorage.setItem('ctct_review_target', 'review.practice.html');

    const a = document.getElementById('reviewLink');
    if (!a) return;
    a.addEventListener('click', function(e){
      e.stopImmediatePropagation();
      e.preventDefault();
      try {
        sessionStorage.setItem('ctct_mode','practice');
        sessionStorage.setItem('ctct_review_from', location.pathname);
      } catch(_){}
      location.assign('review.practice.html?v=20251005');
    }, true);
  })();
  </script>
</body>
</html>
