<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Làm bài kiểm tra – PTKV3</title>

  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

  <style>
    :root{ --brand:#A41919; --brand-600:#8B1616; --bg:#f6f7fb; --card:#fff; --text:#111827; --muted:#6b7280; --border:#e5e7eb; }
    *{box-sizing:border-box}
    html,body{ margin:0;background:var(--bg);color:var(--text); font-family:'Roboto', system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif; }
    .topbar{ position:sticky; top:0; z-index:50; background:var(--brand); color:#fff; padding:12px 16px; display:flex; align-items:center; gap:12px; }
    .topbar a{color:#fff; text-decoration:none} .topbar a:hover{text-decoration:underline} .topbar h2{margin:0; font-size:18px; font-weight:900}
    .container{max-width:1120px;margin:18px auto;padding:0 12px}
    .card{ background:var(--card); border:1px solid var(--border); border-radius:16px; box-shadow:0 2px 10px rgba(0,0,0,.06); padding:16px; margin:12px 0; }
    .grid-3{display:grid; grid-template-columns: 1fr 1fr 1fr; gap:12px;}
    @media (max-width:960px){ .grid-3{grid-template-columns:1fr 1fr} }
    @media (max-width:640px){ .grid-3{grid-template-columns:1fr} }
    .field label{display:block; font-size:14px; color:var(--muted); margin-bottom:6px}
    .field input[type="text"]{
      width:100%; height:42px; padding:10px 12px; font-size:16px; border:1px solid var(--border); border-radius:10px; background:#fff; font-family:inherit;
    }
    .field input[type="text"]:focus{ border-color:var(--brand); outline:0; box-shadow:0 0 0 3px rgba(164,25,25,.10); }
    .meta{ display:grid; grid-template-columns:repeat(3,minmax(200px,1fr)); gap:12px; margin-top:10px; color:var(--muted); font-size:15px; }
    .meta strong{color:var(--text)}
    .center{display:flex; flex-direction:column; align-items:center; gap:18px}
    .btn{ padding:12px 22px; border-radius:10px; border:none; cursor:pointer; font-size:16px; font-weight:800; min-width:140px; font-family:inherit; }
    .btn-primary{background:var(--brand); color:#fff} .btn-primary:hover{background:var(--brand-600)}
    .btn-secondary{background:#eee;color:#333} .btn-secondary:hover{background:#ddd}
    [hidden]{display:none!important}
    #qTitle{font-size:22px;font-weight:700;margin:0 0 8px}
    #qText{font-size:18px;margin:0 0 16px;text-align:justify}
    .progressbar{height:10px;background:#eee;border-radius:8px;margin:0 0 16px;overflow:hidden}
    #progressFill{height:100%;width:0;background:var(--brand);transition:width .25s ease}
    .options-list{margin:0;padding:0;list-style:none}
    .option{ display:flex; align-items:center; gap:12px; background:#fff; border:1px solid var(--border); border-radius:14px; padding:14px 16px; margin-bottom:12px; cursor:pointer; transition:background .2s, border-color .2s, box-shadow .2s; }
    .option:hover{background:#f9f9f9;border-color:#c7c7c7}
    .option input[type="radio"]{ flex:0 0 auto; width:20px; height:20px; accent-color:var(--brand); transform:scale(1.05); }
    .opt-text{flex:1;line-height:1.55;text-align:justify}
    .option:has(input:checked){ background:#fff; border-color:var(--brand); box-shadow:0 0 0 2px rgba(164,25,25,.08); }
    .quiz-actions{display:flex;gap:12px;justify-content:space-between;margin-top:18px;flex-wrap:wrap}
  </style>

  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => { try{ navigator.serviceWorker.register('./sw.js'); }catch(e){} });
    }
    window.CTCT_USE_TRY_API = false;
  </script>
</head>
<body>

  <div class="topbar">
    <a href="index.html">← Trang chủ</a>
    <h2>LÀM BÀI KIỂM TRA</h2>
  </div>

  <main class="container">
    <!-- THÔNG TIN -->
    <section class="card">
      <div class="grid-3">
        <div class="field"><label>Họ và tên</label><input id="fullname" type="text" placeholder="Nhập họ và tên" autocomplete="name"></div>
        <div class="field"><label>Chức vụ</label><input id="position" type="text" placeholder="VD: Trung đội trưởng"></div>
        <div class="field"><label>Đơn vị</label><input id="unit" type="text" placeholder="Nhập đơn vị"></div>
      </div>

      <div class="meta">
        <div>Thời gian: <strong id="time">--:--</strong></div>
        <div>Tiến độ:  <strong id="progress">0/0</strong></div>
        <div>Mã đề:    <strong id="examCode">----</strong></div>
      </div>
    </section>

    <!-- BẮT ĐẦU -->
    <section class="card" id="startCard">
      <div class="center">
        <p>Bài <strong>KIỂM TRA NHẬN THỨC</strong> gồm <strong>50 câu</strong>, thời gian <strong>30 phút</strong>. Câu hỏi & đáp án được đảo ngẫu nhiên.</p>
        <button class="btn btn-primary" id="startBtn" type="button">BẮT ĐẦU</button>
        <button class="btn btn-secondary" id="resumeBtn" type="button" hidden>TIẾP TỤC BÀI ĐANG DỞ</button>
      </div>
    </section>

    <!-- CÂU HỎI -->
    <section class="card" id="quizBox" hidden>
      <h3 id="qTitle">Câu 1</h3>
      <p id="qText"></p>
      <div class="progressbar"><div id="progressFill"></div></div>
      <form id="options" class="options-list"></form>
      <div class="quiz-actions">
        <button type="button" id="prevBtn"   class="btn btn-secondary">← Trước</button>
        <button type="button" id="reviewBtn" class="btn btn-secondary">Xem lại</button>
        <span style="flex:1"></span>
        <button type="button" id="nextBtn"   class="btn btn-secondary">Tiếp →</button>
        <button type="button" id="submitBtn" class="btn btn-primary">Nộp bài</button>
      </div>
    </section>

    <!-- KẾT QUẢ -->
    <section class="card" id="resultCard" hidden>
      <h3>KẾT QUẢ</h3>
      <p id="resultText"></p>
      <p id="classification"></p>
      <div style="display:flex;gap:12px;flex-wrap:wrap">
        <a class="btn btn-secondary" href="review.html">Xem lại & giải thích</a>
        <a class="btn btn-secondary" href="exam.html">Làm lại</a>
        <a class="btn btn-secondary" href="index.html">Về trang chủ</a>
      </div>
    </section>
  </main>
  <script src="config.js"></script>
  <script src="app.js"></script>
  <script src="net.js" defer></script>
  <script src="analytics.js" defer></script>
  <script src="navbar.js" defer></script>

  <!-- Auto-fill giữ nguyên -->
  <script>
    (function(){
      try{
        const me = JSON.parse(localStorage.getItem('ctct_profile')||'{}');
        if (me){
          const f = document.getElementById('fullname');
          const u = document.getElementById('unit');
          const p = document.getElementById('position');
          if (f && !f.value) f.value = me.name || '';
          if (u && !u.value) u.value = me.unit || '';
          if (p && !p.value) p.value = me.position || '';
        }
      }catch(_){}
      try{
        const hasState = !!localStorage.getItem('ctct_exam_state');
        if (hasState) document.getElementById('resumeBtn').hidden = false;
      }catch(_){}
    })();
  </script>
</body>
</html>
